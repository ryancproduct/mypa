# 🚀 Deployment Guide - MyPA Notes PWA

This guide covers deployment options and configuration for the MyPA Notes PWA application.

## 📋 Pre-deployment Checklist

- [ ] All environment variables configured
- [ ] Security audit passed (see `SECURITY_AUDIT.md`)
- [ ] Build tests passing (`npm run build`)
- [ ] TypeScript compilation successful (`npx tsc --noEmit`)
- [ ] Linting clean (`npm run lint`)
- [ ] PWA manifest and service worker configured

## 🔧 Environment Configuration

### 1. Copy Environment Template
```bash
cp .env.example .env.local
```

### 2. Configure Variables
Edit `.env.local` with your specific values:
```bash
# Required
VITE_APP_NAME="Your App Name"
VITE_PWA_THEME_COLOR="#your-color"

# Optional
VITE_ANALYTICS_ID="your-analytics-id"
VITE_SENTRY_DSN="your-sentry-dsn"
```

## 🌐 Deployment Platforms

### Netlify (Recommended)

1. **Connect Repository**
   - Link your GitHub/GitLab repository to Netlify
   - Netlify will auto-detect the build settings from `netlify.toml`

2. **Environment Variables** (Netlify Dashboard)
   ```
   NODE_VERSION = 18
   VITE_ANALYTICS_ID = your-analytics-id
   ```

3. **Deploy**
   ```bash
   # Manual deployment
   npm run build
   netlify deploy --prod --dir=dist
   
   # Or push to main branch for auto-deployment
   git push origin main
   ```

4. **Custom Domain** (Optional)
   - Configure custom domain in Netlify dashboard
   - Update security redirects in `netlify.toml`

### Vercel

1. **Install Vercel CLI**
   ```bash
   npm install -g vercel
   ```

2. **Deploy**
   ```bash
   # Initial deployment
   vercel --prod
   
   # Subsequent deployments
   git push origin main
   ```

3. **Environment Variables** (Vercel Dashboard)
   - Set production environment variables via Vercel dashboard

### GitHub Pages

1. **Enable GitHub Actions**
   - Create `.github/workflows/deploy.yml`:
   ```yaml
   name: Deploy to GitHub Pages
   
   on:
     push:
       branches: [ main ]
   
   jobs:
     deploy:
       runs-on: ubuntu-latest
       steps:
         - uses: actions/checkout@v3
         - uses: actions/setup-node@v3
           with:
             node-version: '18'
         - run: npm install
         - run: npm run build
         - uses: peaceiris/actions-gh-pages@v3
           with:
             github_token: ${{ secrets.GITHUB_TOKEN }}
             publish_dir: ./dist
   ```

2. **Configure Repository**
   - Go to Settings > Pages
   - Set source to "GitHub Actions"

### Docker Deployment

1. **Create Dockerfile**
   ```dockerfile
   FROM node:18-alpine as build
   WORKDIR /app
   COPY package*.json ./
   RUN npm install
   COPY . .
   RUN npm run build
   
   FROM nginx:alpine
   COPY --from=build /app/dist /usr/share/nginx/html
   COPY nginx.conf /etc/nginx/nginx.conf
   EXPOSE 80
   CMD ["nginx", "-g", "daemon off;"]
   ```

2. **Build and Run**
   ```bash
   docker build -t mypa-pwa .
   docker run -p 8080:80 mypa-pwa
   ```

## 🔒 Security Configuration

### Content Security Policy
Add to your hosting platform's headers:
```
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src 'self' https://api.anthropic.com; img-src 'self' data:;
```

### Additional Security Headers
Already configured in `netlify.toml` and `vercel.json`:
- `X-Frame-Options: DENY`
- `X-Content-Type-Options: nosniff`
- `X-XSS-Protection: 1; mode=block`
- `Referrer-Policy: strict-origin-when-cross-origin`

## 📱 PWA Configuration

### Service Worker
- Automatically generated by Vite PWA plugin
- Configured for offline-first strategy
- Pre-caches essential assets

### Web App Manifest
- Generated from `vite.config.ts` PWA configuration
- Supports installation on mobile devices
- Includes shortcuts and categories

### Push Notifications
- Configured for browser notifications
- Requires HTTPS in production
- User permission-based

## 🚀 Build Scripts

```bash
# Development
npm run dev          # Start development server
npm run preview      # Preview production build locally

# Production
npm run build        # Create production build
npm run build:analyze # Build with bundle analyzer

# Quality Assurance
npm run lint         # Run ESLint
npm run type-check   # TypeScript compilation check
npm run audit        # Security audit
```

## 📊 Performance Optimization

### Bundle Analysis
```bash
npm run build:analyze
```

### Lighthouse Audit
- Run Lighthouse audit on deployed version
- Target scores: Performance >90, Accessibility >95, Best Practices >90, SEO >95

### Core Web Vitals
- Monitor LCP (Largest Contentful Paint)
- Optimize CLS (Cumulative Layout Shift)
- Ensure fast FID (First Input Delay)

## 🔧 Troubleshooting

### Common Issues

1. **Build Fails**
   ```bash
   # Clear cache and reinstall
   rm -rf node_modules package-lock.json
   npm install
   npm run build
   ```

2. **Service Worker Not Updating**
   ```bash
   # Force service worker update
   # Clear browser cache and hard reload
   ```

3. **Environment Variables Not Loading**
   - Ensure variables start with `VITE_`
   - Check case sensitivity
   - Restart development server after changes

4. **PWA Not Installing**
   - Verify HTTPS deployment
   - Check manifest.webmanifest is accessible
   - Ensure service worker is registered

### Debug Mode
Enable debug mode for development:
```bash
VITE_SHOW_DEBUG_INFO=true npm run dev
```

## 📚 Additional Resources

- [Vite Deployment Guide](https://vitejs.dev/guide/static-deploy.html)
- [PWA Best Practices](https://web.dev/pwa-checklist/)
- [Workbox Documentation](https://developers.google.com/web/tools/workbox)
- [Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest)

## 🆘 Support

For deployment issues:
1. Check build logs for specific errors
2. Verify environment configuration
3. Test locally with production build (`npm run preview`)
4. Refer to platform-specific documentation

---

*This deployment guide is part of the MyPA Notes PWA documentation.*